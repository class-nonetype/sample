<section class="sign-up-container">
  <div class="sign-up-card">
    <header class="sign-up-header">
      <h2>Crea tu cuenta</h2>
    </header>

    <mat-horizontal-stepper linear class="sign-up-stepper" [attr.aria-busy]="loading()">
      <mat-step [stepControl]="profileGroup" label="Perfil">
        <form [formGroup]="profileGroup" class="step-form">
          <mat-form-field appearance="fill">
            <mat-label>Nombre completo</mat-label>
            <input matInput formControlName="fullName" required />
            <mat-icon matSuffix>badge</mat-icon>
            @if (profileControls.fullName.hasError('required') && profileControls.fullName.touched) {
              <mat-error>Ingresa tu nombre completo.</mat-error>
            }
            @if (profileControls.fullName.hasError('minlength')) {
              <mat-error>Debe tener al menos 3 caracteres.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Correo electronico</mat-label>
            <input matInput formControlName="email" required />
            <mat-icon matSuffix>mail</mat-icon>
            @if (profileControls.email.hasError('required') && profileControls.email.touched) {
              <mat-error>Ingresa tu correo electronico.</mat-error>
            }
            @if (profileControls.email.hasError('email')) {
              <mat-error>El formato del correo no es valido.</mat-error>
            }
          </mat-form-field>

          <div class="step-actions">
            <button mat-flat-button color="primary" matStepperNext [disabled]="profileGroup.invalid">
              <!-- <mat-icon>arrow_forward</mat-icon> -->
              Continuar
            </button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="accountGroup" label="Credenciales">
        <form [formGroup]="accountGroup" class="step-form">
          <mat-form-field appearance="fill">
            <mat-label>Usuario</mat-label>
            <input matInput formControlName="username" required />
            <mat-icon matSuffix>person</mat-icon>
            @if (accountControls.username.hasError('required') && accountControls.username.touched) {
              <mat-error>Ingresa un nombre de usuario.</mat-error>
            }
            @if (accountControls.username.hasError('minlength')) {
              <mat-error>Debe tener al menos 3 caracteres.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Contrasena</mat-label>
            <input
              matInput
              [type]="accountControls.showPassword.value ? 'text' : 'password'"
              formControlName="password"
              required
            />
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="accountControls.showPassword.setValue(!accountControls.showPassword.value)"
              [attr.aria-label]="accountControls.showPassword.value ? 'Ocultar contrase?a' : 'Mostrar contrase?a'"
            >
              <mat-icon>{{ accountControls.showPassword.value ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            @if (accountControls.password.hasError('required') && accountControls.password.touched) {
              <mat-error>Ingresa una contrasena.</mat-error>
            }
            @if (accountControls.password.hasError('minlength')) {
              <mat-error>Debe tener al menos 8 caracteres.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Confirmar contrasena</mat-label>
            <input
              matInput
              [type]="accountControls.showPassword.value ? 'text' : 'password'"
              formControlName="confirmPassword"
              required
            />
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="accountControls.showPassword.setValue(!accountControls.showPassword.value)"
              [attr.aria-label]="accountControls.showPassword.value ? 'Ocultar contrase?a' : 'Mostrar contrase?a'"
            >
              <mat-icon>{{ accountControls.showPassword.value ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            @if (accountControls.confirmPassword.hasError('required') && accountControls.confirmPassword.touched) {
              <mat-error>Confirma tu contrasena.</mat-error>
            }
            @if (accountGroup.hasError('passwordMismatch') && accountControls.confirmPassword.touched) {
              <mat-error>Las contrasenas no coinciden.</mat-error>
            }
          </mat-form-field>

          <div class="step-actions">
            <button mat-button type="button" matStepperPrevious>Volver</button>
            <button mat-flat-button color="primary" matStepperNext [disabled]="accountGroup.invalid">
              <!-- <mat-icon>arrow_forward</mat-icon> -->
              Continuar
            </button>
          </div>
        </form>
      </mat-step>
    <!--
      <mat-step [stepControl]="userGroup" label="Grupo de trabajo">
        <form [formGroup]="userGroup" class="step-form" (ngSubmit)="submit()">
          <select-list [control]="userGroupControls.userGroupId" label="Grupo de equipo"></select-list>

          <div class="sign-up-feedback">
            @if (error()) {
              <div class="sign-up-error">
                <mat-icon aria-hidden="true">error_outline</mat-icon>
                <span>{{ error() }}</span>
              </div>
            }
            @if (success()) {
              <div class="sign-up-success">
                <mat-icon aria-hidden="true">check_circle</mat-icon>
                <span>{{ success() }}</span>
              </div>
            }
          </div>

          <div class="step-actions">
            <button mat-button type="button" matStepperPrevious [disabled]="loading()">Volver</button>
            <button
              mat-flat-button
              color="primary"
              type="submit"
              [disabled]="loading() || userGroup.invalid"
            >
              @if (loading()) {
                <mat-icon class="sign-up-spinner" aria-hidden="true">autorenew</mat-icon>
              }
              {{ loading() ? 'Creando...' : 'Crear cuenta' }}
            </button>
          </div>
        </form>
      </mat-step>

    -->
    </mat-horizontal-stepper>
  </div>
</section>
